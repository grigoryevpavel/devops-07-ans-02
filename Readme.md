# Задачи

1. Подготовьте свой inventory-файл `prod.yml`.
2. Допишите playbook: нужно сделать ещё один play, который устанавливает и настраивает [vector](https://vector.dev). Конфигурация vector должна деплоиться через template файл jinja2.
3. При создании tasks рекомендую использовать модули: `get_url`, `template`, `unarchive`, `file`.
4. Tasks должны: скачать дистрибутив нужной версии, выполнить распаковку в выбранную директорию, установить vector.
5. Запустите `ansible-lint site.yml` и исправьте ошибки, если они есть.
6. Попробуйте запустить playbook на этом окружении с флагом `--check`.
7. Запустите playbook на `prod.yml` окружении с флагом `--diff`. Убедитесь, что изменения на системе произведены.
8. Повторно запустите playbook с флагом `--diff` и убедитесь, что playbook идемпотентен.
9. Подготовьте README.md-файл по своему playbook. В нём должно быть описано: что делает playbook, какие у него есть параметры и теги. Пример качественной документации ansible playbook по [ссылке](https://github.com/opensearch-project/ansible-playbook).
10. Готовый playbook выложите в свой репозиторий, поставьте тег `08-ansible-02-playbook` на фиксирующий коммит, в ответ предоставьте ссылку на него.

# Решение

## Содержимое

1. Плейбук для clickhouse
2. Плейбук для vector

### Плейбук clickhouse

### 1. Переменные плейбука

- clickhouse_version(задает устанавливаему версию clickhouse)
- clickhouse_packages (задает устанавливаемые пакеты clickhouse)
- clickhouse_dest ( папка для установки инсталляционных пакетов clickhouse)

### 2. Описание работы плейбука

- устанавливаются обязательные пакеты: apt-transport-https, ca-certificates, dirmngr
- устанавливается ключ для подключения к официальному хранилищу clickhouse для скачивания дистрибутивув clickhouse-server и clickhouse-client
- устанавливается официальный репозиторий clickhouse
- происходит установка пакетов clickhouse-server и clickhouse-client
- по окончании установки происходит запуск сервера clickhouse
- создается БД **logs**, если она еще не существует


### Плейбук для vector

### 1. Переменные плейбука

- vector_hostname (задает ip-адрес по которому будет доступен api vector. По умолчанию 127.0.0.1)
- vector_port (задает порт на котором будет доступен api vector. По умолчанию 8686)
- vector_dest ( папка для установки инсталляционных пакетов vector)

### 2. Описание работы плайбука 

- Скачивает конфигурационный **[скрипт](https://repositories.timber.io/public/vector/cfg/setup/bash.deb.sh)**
- Запускает конфигурационный скрипт. Скрипт прописывает репозиторий с официальным дистрибутивом vector.
- Устанавливает **vector** из репозитория командой **apt install vector**, предварительно выполнив **apt update**
- На основе **[jinja2 шаблона](vector/vector.j2)** генерируется рабочую конфигурацию vector 



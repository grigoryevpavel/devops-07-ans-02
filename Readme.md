## Содержимое

1. Плейбук для clickhouse
2. Плейбук для vector

###  [Плейбук clickhouse](site.yml)

### 1. Переменные плейбука

- clickhouse_prerequisites задает список обязательных пакетов для установки перед началом установки clickhouse
- clickhouse_packages  задает устанавливаемые пакеты clickhouse
- clickhouse_query задает запрос, который выполняется после установки clickhouse. По умолчанию создает БД logs, если та еще не существует.

### 2. Описание работы плейбука

- устанавливаются обязательные пакеты: apt-transport-https, ca-certificates, dirmngr
- устанавливается ключ для подключения к официальному хранилищу clickhouse для скачивания дистрибутивув clickhouse-server и clickhouse-client
- устанавливается официальный репозиторий clickhouse
- происходит установка пакетов clickhouse-server и clickhouse-client
- по окончании установки происходит запуск сервера clickhouse
- создается БД **logs**, если она еще не существует

### 3. Теги 

- prerequisites позволяет произвести только установку репозитория с дистрибутивом clickhouse
- clickhouse позволяет установить из предустановленного репозитория последнюю версию официального дистрибутива clickhouse

### [Плейбук vector](vector.yml)

### 1. Переменные плейбука

- vector_hostname (задает ip-адрес по которому будет доступен api vector. По умолчанию 127.0.0.1)
- vector_port (задает порт на котором будет доступен api vector. По умолчанию 8686)
- vector_dest ( папка для установки инсталляционных пакетов vector)

### 2. Описание работы плайбука 

- Скачивает конфигурационный **[скрипт](https://repositories.timber.io/public/vector/cfg/setup/bash.deb.sh)**
- Запускает конфигурационный скрипт. Скрипт прописывает репозиторий с официальным дистрибутивом vector.
- Устанавливает **vector** из репозитория командой **apt install vector**, предварительно выполнив **apt update**
- На основе **[jinja2 шаблона](vector/vector.j2)** генерируется рабочую конфигурацию vector 

### 3. Теги 

- prerequisites позволяет произвести только скачивание инициализационного скрипта и установку на его основе репозитория с дистрибутивом vector
- vector позволяет установить из предустановленного репозитория последнюю версию официального дистрибутива vector
- vector_conf позволяет установить новую конфигурацию vector

